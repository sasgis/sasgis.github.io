# Что такое тайл?

**Тайл** (от англ. *tile* - плитка) в картографических сервисах - это одно из множества изображений на которые разбивается карта. Тайлы отображаются рядом друг с другом, создавая впечатление одной большой картинки. Поверхность Земли огромна и использование тайловой структуры позволяет передавать изображения только той её части, которую просматривает пользователь, что экономит интернет-трафик. Также, поскольку большую часть Земли покрывает вода, для карты достаточно хранить и показывать один синий тайл для всего мирового океана, что экономит дисковое пространство.

Изображения растровых тайлов хранятся в двух форматах:

- **JPEG** (спутниковые снимки, отсканированные карты) - сжатие с потерями, но лучшей компрессией
- **PNG** (изначально цифровые карты, полупрозрачные слои) - изображение сжимается без потерь и с поддержкой прозрачности, но занимает больше места

Большинство картографических сервисов предоставляют квадратные тайлы размерами 256х256 пикселей, поэтому в SAS.Планете принят именно такой размер. Формат тайлов по умолчанию - JPEG.

# Тайловая сетка

Картинка 256×256 пикселов слишком мала, чтобы отобразить на ней подробную карту - поэтому тайлы организованы в виде пирамиды. Существует негласный стандарт [Slippy map](https://wiki.openstreetmap.org/wiki/RU:%D0%9F%D0%BE%D0%B4%D0%B2%D0%B8%D0%B6%D0%BD%D0%B0%D1%8F_%D0%BA%D0%B0%D1%80%D1%82%D0%B0) (*Подвижная карта*) согласно которому работает большинство картографических сервисов:

- Нумерация масштабов `{z}` идёт с нуля, при этом нулевой масштаб представлен одним тайлом и на нём изображена вся планета. В реальном мире можно встретить масштабы 0-18 для спутниковых снимков. Иногда до 22 в случае съёмки с [БПЛА](https://ru.wikipedia.org/wiki/%D0%91%D0%B5%D1%81%D0%BF%D0%B8%D0%BB%D0%BE%D1%82%D0%BD%D1%8B%D0%B9_%D0%BB%D0%B5%D1%82%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D0%B0%D0%BF%D0%BF%D0%B0%D1%80%D0%B0%D1%82) или очень подробных карт.
- Масштаб тайлов кратен двойке: при увеличении зума каждый тайл делится на четыре (два по вертикали и два по горизонтали), т.е. количество тайлов на слое равно 4<sup>z</sup> (4 в степени z). Так, на масштабе 18: 4<sup>18</sup> = 68719476736
- Тайлы нумеруются слева-направо `{x}`, сверху-вниз `{y}`. Т.о. начало координат находится в NW (North-West) углу
- Для сопоставления географических координат и [тайловых координат](https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames) (т.е. проецирования круглой Земли на квадраты тайлов) используется проекция Меркатора [`EPSG:3857`](zmp-epsg-codes.md)

Данный подход используется в Google Maps, OpenStreetMap и др. В силу исторических причин, в SAS.Planet нумерация слоёв начинается не с нуля, а с единицы: `{z}` = `GetZ-1`, на что нужно обратить внимание при создании zmp.

Как следствие особенностей координатной сетки, ссылка на тайл может быть аналогичной пути в файловой системе, например `./{z}/{x}/{y}.jpg`. Такой способ хранения тайлов прост (соответствует кэшу "Mobile Atlas Creator"), но немногие файловые системы могут эффективно хранить и быстро предоставлять доступ к миллионам мелких файлов. Поэтому последние версии SAS.Planet используют базу данных SQLite для хранения кэша (`CacheType=71`).

**Примеры тайлов:**

![Пример JPEG тайла](assets/tile_example.jpg) ![Пример PNG тайла](assets/tile_example.png)

**Ссылки:**

- [Tiled web map](https://en.wikipedia.org/wiki/Tiled_web_map)
- [Уровни зума](https://wiki.openstreetmap.org/wiki/RU:Zoom_levels)
- [MIP-текстурирование](https://ru.wikipedia.org/wiki/MIP-%D1%82%D0%B5%D0%BA%D1%81%D1%82%D1%83%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
- [GIS-Lab: Основы конфигурирования тайловых сеток](https://gis-lab.info/qa/tile-matrix.html)
