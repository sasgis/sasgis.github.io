# Описание файла params.txt

Файл **params.txt** представляет собой обычный [ini файл](https://ru.wikipedia.org/wiki/.ini) со следующими секциями:

  - [PARAMS] - основные настройки карты
  - [ViewInfo] - настройки отображения
  - [PARAMS_Vector]
  - [PARAMS_Vector_Point] - настройки оформления точек
  - [PARAMS_Vector_Line] - настройки оформления линий
  - [PARAMS_Vector_Poly] - настройки оформления полигонов

!!! note
    Некоторые из параметров карты могут быть изменены внутри программы, без необходимости редактирования файла `params.txt`.
    Для этого нужно зайти в `Параметры - Параметры карты` или нажать `Ctrl+P`.
    Пользовательские изменения настроек карт сохраняются в файле `Maps/Maps.ini`.

## **[PARAMS]**

- **Enabled** - использовать карту. Не обязателен, по умолчанию равен `1`
 
- **GUID** — уникальный идентификатор карты, должен быть заключён в фигурные скобки: `{`...`}`. Можно [сгенерировать онлайн](https://www.guidgen.com/) или в Pascal Script IDE (Главное меню - Помощь)
- **pnum** — порядковый номер карты в меню: карты с большим значением будут отображаться после карт с меньшим значением. Не обязателен, по умолчанию равен `0` 

- **asLayer** — если равно `1`, то карта используется как слой, накладываемый поверх основной карты. Не обязателен, по умолчанию равен `0`
- **LayerZOrder** - порядок отображения слоёв: слои с большим значением будут отображаться поверх слоев с меньшим значением. Не обязателен, по умолчанию равен `0`

- **ParentSubMenu** — название пункта родительского меню для данной карты на английском языке. Для добавления названий на других языках, к названию параметра нужно добавить нижнее подчёркивание и код языка. Например:
    - **ParentSubMenu_ru** — название пункта родительского меню на русском языке
    - **ParentSubMenu_uk** — название пункта родительского меню на украинском языке

!!! info
    Существует возможность создать иерархическое меню, разделив пункты символом `\` (например, `ParentSubMenu_ru=Спутниковые\Google`)

- **name** — имя карты на английском языке. Для добавления названий на других языках, к названию параметра нужно добавить нижнее подчёркивание и код языка. Например:
    - **name_ru** — имя карты на русском языке
    - **name_uk** — имя карты на украинском языке

- **separator** — если равно 1, то отображать разделитель в виде горизонтальной черты, в меню после данной карты. Не обязателен, по умолчанию равен `0`

- **CacheType** — [тип кэша](https://github.com/sasgis/sas.planet.src/blob/master/Src/TileStorage/c_CacheTypeCodes.pas), в который будут записываться тайлы данной карты. Некоторые форматы кэша подходят только для экспорта тайлов. Не обязательный, по умолчанию равен `0`

| CacheType | Название | Примечание |
|-----------|----------|------------|
| 0 | По умолчанию | Ранее использовался 2, теперь 71 |
| 1 | GoogleMV | `cache_old/{name}/{z+1}/{q}.{ext}` <br> Тайловый кэш в формате программы GoogleMV. Для адресации тайлов используется схема [Bing Maps Quadkey](https://learn.microsoft.com/en-us/bingmaps/articles/bing-maps-tile-system)|
| 2 | SAS.Planet | `cache/{name}/z{z+1}/{x/1024}/x{x}/{y/1024}/y.{ext}` <br> Тайловый кэш в родном формате программы SAS.Планета|
| 3 | EarthSlicer 1.95 | `cache_es/{name}/xx-xxx-xxx/{z+1}/xxxxxxx/{z+1}-{x}-{y}.{ext}` <br> Тайловый кэш в формате программы EarthSlicer|
| 4 | GlobalMapper Tiles (GMT) | `cache_gmt/{name}/z{z}/{x}/{y}.{ext}` |
| 41 | GlobalMapper Aux | `cache_gmt/{name}/z{z}/{y}_{x}.{ext}` |
| 42 | GlobalMapper Bing | `cache_gmt/{name}/{z}/{y}/{x}.{ext}` <br> [Тикет 780](http://www.sasgis.org/mantis/view.php?id=780)|
| 43 | [Mobile Atlas Creator (MOBAC)](https://mobac.sourceforge.io/) | `cache_ma/{name}/{z}/{x}/{y}.{ext}` <br> [Тикет 1936](http://www.sasgis.org/mantis/view.php?id=1936). Тип кэша известен как [Slippy map](https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames). Нумерация тайлов как в [OpenStreetMap](https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames) и Google. Кэш подключается к QGIS, [MapProxy](https://mapproxy.github.io/mapproxy/latest/caches.html#cache-file). Для использования с [JOSM](https://josm.openstreetmap.de/): <br> `tms:file:///home/user/SAS/cache_ma/sat/{z}/{x}/{y}.jpg` (Linux) <br> `tms[18]:file:///c:/SAS/cache_ma/sat/{z}/{x}/{y}.jpg` (Windows)
| 44 | OsmAnd+ Tiles | Экспорт: `{z}/{x}/{y}.{ext}.tile` [(тикет 884)](http://www.sasgis.org/mantis/view.php?id=884). <br> Не то же самое что "OsmAnd (SQLite3)" `*.sqlitedb` [(тикет 3577)](http://www.sasgis.org/mantis/view.php?id=3577) |
| 45 | [Tile Map Service (TMS)](https://wiki.openstreetmap.org/wiki/TMS) | `cache_tms/{name}/{z}/{x}/{-y}.{ext}` <br> [Тикет 2848](http://www.sasgis.org/mantis/view.php?id=2848), Спецификация на [osgeo.org](https://wiki.osgeo.org/wiki/Tile_Map_Service_Specification) |
| 5 | Google Earth | `cache_ge/` |
| 51 | Google Earth Terrain |  `cache_ge/` |
| 6 | [BerkeleyDB](https://ru.wikipedia.org/wiki/Berkeley_DB) | `cache_db/{name}/z{z+1}/{x/1024}/{y/1024}/{x/256}.{y/256}.sdb` |
| 61 | BerkeleyDB (Versioned) | `cache_dbv/{name}/z{z+1}/{x/1024}/{y/1024}/{x/256}.{y/256}.sdbv` |
| 7 | DBMS (СУБД) |
| 71 | SQLite3 | `cache_sqlite/{name}/z{z+1}/{x/1024}/{y/1024}/{x/256}.{y/256}.sqlitedb` <br> Создаётся несколько баз SQLite, каждая из которых содержит квадрат из 256×256 тайлов. [Тикет 1376](http://www.sasgis.org/mantis/view.php?id=1376#c10961) |
| 72 | [MBTiles](https://wiki.openstreetmap.org/wiki/MBTiles) | `cache_mbtiles/{name}/{name}.mbtiles` <br> Используется одна база SQLite. [Тикет 1919](http://www.sasgis.org/mantis/view.php?id=1919) <br> [Спецификация MapBox](https://github.com/mapbox/mbtiles-spec) |
| 73 | OsmAnd | `cache_osmand/{name}/{name}.sqlitedb` <br> Используется одна база SQLite. [Тикет 1919](http://www.sasgis.org/mantis/view.php?id=1919) |
| 74 | Locus | `cache_locus/{name}/{name}.sqlitedb` <br> Используется одна база SQLite. [Тикет 1919](http://www.sasgis.org/mantis/view.php?id=1919)  |
| 75 | RMaps | `cache_rmaps/{name}/{name}.sqlitedb` <br> Используется одна база SQLite. [Тикет 1919](http://www.sasgis.org/mantis/view.php?id=1919)  |
| 76 | OruxMaps | Кэш только для чтения. <br> Используется одна база SQLite + файл с метаданными. [Тикет 1919](http://www.sasgis.org/mantis/view.php?id=1919)  |
| 8 | GeoCacher |  `cache_gc/` |
| 9 | RAM | Кэш в памяти. Тайлы на диск не записываются, кэш имеет ограниченный объём и время жизни. [Тикет 1755](http://www.sasgis.org/mantis/view.php?id=1755) |

- **IsReadOnly** - использовать кэш в режиме "Только чтение". Не обязательный, по умолчанию равен `0`
- **AllowRead**, **AllowScan**, **AllowAdd**, **AllowDelete**, **AllowReplace** - тонкая настройка разрешённых операций для кэша тайлов
- **NameInCache** — имя папки в кэше, в которую будут записываться тайлы карты.
- **Ext** — расширение тайла (`.jpg`, `.png`, `.bmp` и т.д.). Задаёт формат, в котором принудительно будут сохраняться карты, если `Content-Type` не совпадает.

- **CanShowOnSmMap** - если равно 1, то разрешено показывать на карте обзора. Не обязательный, по умолчанию равен `1`
- **UseDwn** — если равно 1, то скачивать тайлы карты разрешено. Не обязательный, по умолчанию равен `1`
- **AllowUseCookie** - разрешить автоматическое сохранение (установку) cookie для HTTP запросов. Не обязательный, по умолчанию равен `0`
- **Sleep** — величина паузы между загрузками отдельных тайлов в миллисекундах. Не обязательный, по умолчанию равен `0`
- **DefURLBase** — неизменная часть адреса ссылки на тайлы карты. Или шаблон URL адреса в случае [упрощенного добавления карт](zmp-url-templates.md).
- **RequestHead** — пользовательские HTTP-заголовки (headers), передаваемые на сервер. Поля должны отделяться символами `\r\n` (пример: `RequestHead=Referer: https://google.com\r\nConnection: Keep-Alive`).
- **ServerNames**
- **Proj4Args**
  
- **ContentType** — список форматов изображений (например, `ContentType=image/jpeg,image/png`), которые SAS.Planet ожидает получить от сервера. При несовпадении формата (например, сервер вернул текст, а не картинку) отображается ошибка.
- **DefaultContentType** — тип, который будет использоваться, если сервер не вернул никакого типа или если стоит игнорирование типа, возвращаемого сервером.
- **IgnoreContentType** — игнорирование типа, возвращаемого сервером.
- **DetectContentType** - если равно 1, то после загрузки тайла будет выполнятся анализ его содержимого и коррекция поля `Content-Type` в заголовках ответа сервера
- **MimeTypeSubst** — подстановка типа загружаемых данных (например, `"image/png8bit=image/png"`).
- **MainStorageContentType**

[Список](https://github.com/sasgis/sas.planet.src/blob/master/Src/ContentType/u_ContentTypeManagerSimple.pas#L179) поддерживаемых **ContentType** и соответствующие им **Ext**:

| ContentType | Ext |
|-------------|-----|
| application/vnd.sas.wikimapia.kml+xml [^1] | .kml |
| application/vnd.sas.wikimapia.kmz [^1] | .kmz |
| application/vnd.google-earth.kml+xml | .kml |
| application/vnd.google-earth.kmz | .kmz |
| application/gpx+xml | .gpx |
| application/json | .json |
| application/geo+json | .geojson |
| application/vnd.sas.wikimapia.txt | .wikitxt |
| image/jpg, image/jpeg, image/pjpeg| .jpg, .jpeg |
| image/png, image/x-png, image/png; mode=24bit| .png |
| image/gif | .gif |
| image/bmp, image/x-ms-bmp, image/x-windows-bmp | .bmp |
| image/webp | .webp |
| image/tiff | .tif, .tiff |

[^1]: Используется упрощённый парсер kml (без поддержки стилей оформления)

- **TileRLeft**, **TileRRight**, **TileRTop**, **TileRBottom** — параметры для обрезки скачиваемых тайлов соответственно слева, справа, сверху и снизу. Если получившийся прямоугольник не совпадает с квадратом 256×256, он ещё и растягивается или сжимается до этого размера.
- **CutCountX**, **CutCountY**, **CutSizeX**, **CutSizeY**, **CutTileX**, **CutTileY**, **CutToSkip** 
- **IteratorSubRectSize**

- **UsePreloadPage** — если равно `1`, использовать предварительно загружаемую страницу (обязательно следует указать её адрес).
- **PreloadPage** — адрес предварительно загружаемой страницы.

- **Version** — версия тайлов, соответствует переменной `Version` в `GetUrlScript.txt`.

- **MaxConnectToServerCount** — максимальное число потоков. Значение по умолчанию устанавливается в секции `[ZmpDefaultParams]` файла `SASPlanet.ini`
- **IsUseDownloaderInScript** - если равно 1, то разрешено использование скачивания внутри скрипта. По умолчанию равно `0`.

- **UseMemCache** - использовать кэш в памяти (при `CacheType=9` (RAM-кэш) отключение данной опции приведёт к ошибке). По умолчанию равно `1` (включено)
- **MemCacheCapacity** - количество тайлов кэшируемых в память. По умолчанию равно `100`
- **MemCacheTTL** - время жизни тайлов (в миллисекундах), кэшируемых в память. По умолчанию равно `60000` мс. (1 мин)
- **MemCacheClearStrategy** - стратегия очистки (по TTL) кэшируемых в память тайлов. Принимает значения:
    - `0` - удалять ВСЕ тайлы из RAM-кэша, если истёк TTL у самого СТАРОГО тайла;
    - `1` - удалять ВСЕ тайлы из RAM-кэша, если истёк TTL у самого МОЛОДОГО тайла (значение по умолчанию);
    - `2` - удалять только те тайлы, у которых истёк TTL;
    - `3` - НЕ удалять тайлы по TTL.
- **RestartDownloadOnMemCacheTTL** - автоматически перезакачивать тайлы в пределах видимой области экрана при очистке RAM-кэша (работает только если UseMemCache=1). По умолчанию равно `0` (отключено).

- [**EPSG**](zmp-epsg-codes.md) — код проекции карты (вместо **projection**, **sradiusa**, **sradiusb**)

- [**projection**](zmp-epsg-codes.md) — проекция карты:
    - `1` — меркатор на сфероид, 
    - `2` — меркатор на эллипсоид, 
    - `3` — широта/долгота.
- [**sradiusa**](zmp-epsg-codes.md) — радиус большой полуоси эллипсоида.
- [**sradiusb**](zmp-epsg-codes.md) — радиус меньшей полуоси эллипсоида.

- **DefHotKey** — сочетание горячих клавиш для данной карты.
- **License** - текст лицензии, который будет выводиться в левом верхнем углу карты. Требуется для соблюдения условий распространения некоторых карт.
- **BigIconName**, **SmallIconName** - имя файла с иконкой 24x24 пикселей и 18x18 пикселей соответственно. По умолчанию, программа ищет иконки с именами 24.bmp, 24.png и 18.bmp, 18.png соответственно. Иконка размером 18x18 опциональна, при её отсутствии она будет сгенерирована автоматически из иконки 24x24 пикселей.
- **MapCenter** - координаты и зум центра карты. Значения указываются через запятую, без пробелов, в формате: долгота, широта, зум (нумерация зума начинается с нуля). Например, Сан-Франциско: `-122.1906,37.7599,11`

## **[ViewInfo]**

- **[EPSG](zmp-epsg-codes.md)** — код проекции карты при выводе на экран.

В ночных версиях появилась возможность использовать более продвинутый, хоть и медленный парсер KML, с поддержкой чтения оформления меток, линий и полигонов или принудительно задать свои настройки для конкретного ZMP. Для того чтобы включить и настроить эти функции, используются следующие разделы:

## **[PARAMS_Vector]**

- **UseAppearance** — если равно 1, то включается использование оформления из ZMP и загруженных векторных тайлов.

## **[PARAMS_Vector_Point]**

Настройки оформления точек.

- **IconName** — имя иконки по умолчанию.
- **IsForceIconName** — если равно 1 (это значение по умолчанию), то будет принудительно использоваться заданная в параметре **IconName**, даже если парсер смог считать имя иконки из параметров точки.
- **IconSize** — размер иконки по умолчанию.
- **IsForceIconSize** — если равно 1 (это значение по умолчанию), то будет принудительно использоваться размер иконки, заданный в **IconSize**, даже если парсер смог считать размер из параметров точки.

## **[PARAMS_Vector_Line]**

Настройки оформления линий.

- **LineColor** — цвет линии по умолчанию.
- **IsForceLineColor** — если равно 1 (это значение по умолчанию), то будет принудительно использоваться цвет из **LineColor**, даже если парсер смог считать настройки из параметров линии.
- **LineWidth** — толщина линии по умолчанию.
- **IsForceLineWidth** — если равно 1 (это значение по умолчанию), то будет принудительно использоваться толщина линии, заданная в **LineWidth**, даже если парсер смог считать настройки из параметров линии.

## **[PARAMS_Vector_Poly]**

Настройки оформления полигонов.

- **LineColor** — цвет границы полигона по умолчанию.
- **IsForceLineColor** — если равно 1 (это значение по умолчанию), то будет принудительно использоваться цвет из **LineColor**, даже если парсер смог считать настройки из параметров полигона.
- **LineWidth** — толщина границы полигона по умолчанию.
- **IsForceLineWidth** — если равно 1 (это значение по умолчанию), то будет принудительно использоваться толщина линии, заданная в **LineWidth**, даже если парсер смог считать настройки из параметров полигона.
- **FillColor** — цвет заливки полигона по умолчанию.
- **IsForceFillColor** — если равно 1 (это значение по умолчанию), то будет принудительно использоваться цвет из **FillColor**, даже если парсер смог считать настройки из параметров полигона.